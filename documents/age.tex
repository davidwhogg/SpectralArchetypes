\documentclass[12pt, preprint]{aastex}

\newcommand{\sectionname}{Section}
\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\var}{\sigma^{2}}
\newcommand{\invvar}{\sigma^{-2}}

\begin{document}

\title{Data-driven stellar age estimates}
\author{
  David~W.~Hogg,
  Hans-Walter~Rix, others
}

\begin{abstract}
We perform simple emission-line-based (activity-based) age
determinations without the use of \emph{any} stellar models or model
spectra from libraries.  The method is based on K-nearest-neighbor
methods from machine learning.
\end{abstract}

\section{introduction}

...Age is indicated by emission lines in main-sequence dwarfs...

...Fitting of the emission lines is complicated by the non-trivial
spectral shape near the lines.  Spectral models of stars aren't good
enough to handle this.  But the large number of stars we have observed
ought to be able to provide!

...In what follows, we use novel machine-learning-like methods that
have been designed to find structure in large, high dimensional data
sets to perform flexible fitting tasks with stellar spectra.

...Related prior work includes PCA, HMF, XD, SVM.  These all build
data-driven models of non-trivial data sets, and all could be used
here.  We are choosing KNN because of its \emph{capacity}...

\section{method}

There are $N$ stars $n$, for each of which we have a spectrum $F_n$
(with dimensions of energy per time per area per wavelength).  Each
spectrum $F_n$ is represented as $L$ values $F_{n\ell}$ on a standard set
of rest-frame wavelengths $\lambda_\ell$.  These wavelengths are truly
rest-frame, because the \project{SDSS} spectral extraction pipelines
permit extraction of the spectrum shifted to the rest frame by the
(presumably well-measured) redshift.

Every measurement $F_{n\ell}$ comes with an uncertainty inverse
variance $\invvar_{n\ell}$.  We manipulate inverse variance rather
than ``sigma'' or variance because the inverse variance is the weight
for weighted least squares, and because missing data get zeros (not
infinities) in this well-behaved quantity.  In general, because of
observing and data analysis realities, all the weights
$\invvar_{n\ell}$ are different and not directly computable from the
$F_{n\ell}$ or any trivial combination of meta-data.  The data are
considered to be maximally heteroskedastic and arbitrarily censored,
but all in a known way.

In addition to these data requirements, we require that we have, in
hand, an emission-line spectral template that we believe is
age-indicating.  In this instance, the template is the pair of
emission lines...whatever...smoothed to the spectral resolution of the
\project{SDSS} spectrograph.  It is shown in Figure~HOGG.

In broad strokes, the KNN algorithm finds, for each target spectrum,
$K$ nearest neighbors, and uses these to build a data-driven model of
the target spectrum as the ``background'' on which the age indicator
is fit.  In detail, the KNN algorithm is as follows:
\begin{enumerate}
\item For every pair $(m, n)$ of spectra, under the assumption that
  the two stars are identical in every respect except for distance and
  age, obtain the chi-squared minimum (squared) distance ratio
  $[D_m/D_n]^2$ by weighted linear least-square fitting.  The weight
  for each pixel $\ell$ in the fit is $[\var_{m\ell} +
    \var_{n\ell}]^{-1}$, but zeroed out in the $d$ spectral pixels
  closest in wavelength to the age-indicator emission lines.  The fit
  is to $[L-d]$ spectral pixels (data points) with 1 parameter.  In
  addition to the best-fit distance ratio, save $\chi^2_{mn}$, the
  chi-squared value at that optimum.  In principle this step can be
  sped up by only computing the distance-ratio fit for pairs of stars
  that have similar colors or derived properties in advance.  The
  width $d$ of the excluded region near the age-indictor lines is a
  free parameter of the method.
\item For each spectrum $n$, find the $K$ nearest neighbors $k$ in a
  chi-squared sense, using the minimum chi-squared values
  $\chi^2_{kn}$ as the ``distance''.  For our purposes here and below,
  the $K$ nearest neighbors \emph{includes} spectrum $n$.  $K$ is a
  free parameter of the method.
\item Each of the $K$ neighbor spectra $F_k$, plus the previously
  computed optimal (squared) distance ratio $[D_k/D_n]^2$, effectively
  makes a prediction for the small number $d$ of spectral pixels
  $F_{n\ell}$ near the age-indicator lines.  We perform a weighted
  linear least-squares fit (weighting each pixel $k\ell$ by
  $\invvar_{k\ell}$), to the $[d\,K]$ relevant spectral pixels (data
  points) with $[d+K]$ parameters: There are $d$ spectral pixel values
  in the small wavelength region to represent the assumed common
  distance-corrected stellar spectral shape.  There are $K$ amplitudes
  for the age-indicator emission template spectrum, one per star.
  Save all the fit parameters, $d+K$ for each of the $N$ spectra.
\item The age indicator for star $n$ is the age-indicator amplitude
  from the $[d+K]$-parameter fit corresponding to the spectrum which
  was used as the central spectrum in the nearest-neighbor draw.  This
  means that the whole procedure needs to run $N$ times.  Things could
  be sped up with cleverness, but computers are cheap!
\end{enumerate}

This version of the algorithm has only two free external (or hyper-)
parameters: the integer width $d$ and the number of neighbors $K$.
More sophisticated versions that do more conditioning, combine
information from neighbors in a weighted way, or make shortcuts to
reduce computation, would have more hyper-parameters.

\section{data and results}

...For data we take the \project{SEGUE-II} whatever... Rix?

\section{discussion}

\acknowledgements It is a pleasure to thank
  Ross Fadely,
  Rob Fergus,
  Dan Foreman-Mackey, and
  Dilip Krishnan
for valuable discussions.

\end{document}
